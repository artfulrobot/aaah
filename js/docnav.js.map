{"version":3,"sources":["docnav.js"],"names":["DocNav","outputElement","headings","disableWaypoints","last","l","length","baseLevel","parseInt","tagName","currentLevel","map","title","children","e","parent","currentParent","flatMap","i","eq","before","headingDepth","id","newChild","push","text","selected","thisDocNav","docnavVue","Vue","el","data","theMap","docNav","template","li","docnavWaypoint","Waypoint","element","offset","handler","direction","console","log","selectItem","prototype","splice","ptr","component","props","methods","focus","preventDefault","addClass","prev","scrollIntoView","window","setTimeout","removeClass","getClasses","c","depth","jQuery","find","not","o","append"],"mappings":"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","file":"docnav.js","sourcesContent":["function DocNav(outputElement, headings) {\n  this.disableWaypoints = true;\n  this.outputElement = outputElement;\n  this.headings = headings;\n  var last = 0;\n  var l = this.headings.length;\n  var baseLevel = parseInt(this.headings[0].tagName[1]);\n  var currentLevel = 0;\n  var map = { title: 'No title', children: [], e:null, parent:null };\n  var currentParent = map;\n  var flatMap = {};\n  for (var i=0; i<l; i++) {\n    var e = this.headings.eq(i);\n    e.before('<span class=\"docnav__fakeanchor\"/>');\n    var headingDepth = e[0].tagName[1] - baseLevel;\n    if (!e[0].id) {\n      e[0].id = 'docnav' + i;\n    }\n\n    // Find the appropriate parent for this new thing, store it in currentParent.\n    if (headingDepth > currentLevel) {\n      // Deal with skipped headers, h2...h4\n      while (headingDepth > currentLevel) {\n        // Add empty child.\n        var newChild = { title: 'No title', children: [], e:null, parent:currentParent };\n        currentParent.children.push(newChild);\n        currentLevel++;\n        currentParent = newChild;\n      }\n    }\n    else if (headingDepth < currentLevel) {\n      while (headingDepth < currentLevel && currentLevel>0) {\n        // This is an ancestor.\n        currentParent = currentParent.parent;\n        currentLevel--;\n      }\n    }\n\n    // Got current Parent, create the element now and set that as the currentParent.\n    var newChild = { title: e.text(), children: [], e:e, parent: currentParent };\n    //console.log(e[0].tagName, \"currentParent: \", currentParent);\n    currentParent.children.push(newChild);\n    currentLevel++;\n    currentParent = newChild;\n    flatMap[e[0].id] = newChild;\n  }\n  this.map = map;\n  //console.log(\"map \", map, \"output ele\", this.outputElement);\n  // Create Vue app.\n  this.selected = [map.children[0]];\n  var thisDocNav = this;\n  var docnavVue = new Vue({\n    el: this.outputElement[0],\n    data: {theMap: map, selected : this.selected, docNav: thisDocNav },\n    template: `<div class=\"docnav-wrapper\"><docnav\n      :doc-nav=\"docNav\"\n      :item=\"theMap\"\n      :selected=\"selected\"\n      depth=\"0\" /></div>`,\n  });\n\n  for (var i=0; i<l; i++) {\n    var e = this.headings.eq(i);\n    var li = flatMap[e[0].id];\n    // Set up a waypoint for this element.\n    (function(li){\n      li.e.docnavWaypoint = new Waypoint({\n        element: li.e[0],\n        offset: '60%',\n        handler: function(direction) {\n          if (!thisDocNav.disableWaypoints && direction=='down') {\n            console.log(direction, \"bottom in view \", li.e[0]);\n            thisDocNav.selectItem(li);\n          }\n        }\n      });\n      li.e.docnavWaypoint = new Waypoint({\n        element: li.e[0],\n        offset: '20%',\n        handler: function(direction) {\n          if (!thisDocNav.disableWaypoints && direction=='up') {\n            console.log(direction, \"top in view \", li.e[0]);\n            thisDocNav.selectItem(li);\n          }\n        }\n      });\n    })(li);\n  }\n\n  this.disableWaypoints = false;\n}\nDocNav.prototype.selectItem = function(li) {\n  this.selected.splice(0, this.selected.length, li);\n  //console.log(\"NEW SELECTION1:\", this.selected.map(x => { return x.title; }));\n  var ptr = li.parent;\n  while (ptr.parent) {\n    this.selected.push(ptr);\n    ptr = ptr.parent;\n  }\n};\n\nVue.component('docnav', {\n  props: ['item', 'depth', 'selected', 'docNav'],\n  template: `<ul :class=\"\\'docnav depth-\\' + depth\">\n    <li v-for=\"li in item.children\"\n      :class=\"getClasses(li)\"\n      >\n      <a v-if=\"li.e\" href @click=\"focus(li, $event)\" >{{li.title}}</a>\n      <docnav\n        :selected=\"selected\"\n        :item=\"li\"\n        :doc-nav=\"docNav\"\n        :depth=\"parseInt(depth) + 1\"\n        v-if=\"li.children.length>0\"\n        />\n    </li></ul>`,\n  methods: {\n    focus: function(li, e) {\n      // console.log(\"focus\", li, e);\n      if (e) e.preventDefault();\n      this.docNav.disableWaypoints = true;\n      li.e.addClass('attention').prev()[0].scrollIntoView();\n      this.docNav.selectItem(li);\n      window.setTimeout(function() { li.e.removeClass('attention');}, 1000);\n      var docNav = this.docNav;\n      window.setTimeout(function() { docNav.disableWaypoints = false; }, 300);\n    },\n    getClasses: function(li) {\n      //console.log(\"getClasses selected:\", this.selected, \" this li: \", li);\n      var c = {\n        selected: (li.e == this.selected[0].e)\n      };\n      c['depth-' + this.depth] = true;\n      var l = this.selected.length;\n      for (var i=1; i<l; i++) {\n        if (this.selected[i].e == li.e) {\n          c['selected-route'] = true;\n        }\n      }\n      if (li.e === null) {\n        // Inaccessible empty layers show as open.\n        c['selected-route'] = true;\n      }\n      return c;\n    }\n  }\n});\n\njQuery(function(){\n  var i = jQuery('.field-name-body .field-item').find('h1, h2, h3, h4, h5').not('aside h1, aside h2');\n  var o = jQuery('<div/>');\n  jQuery('aside.sidebar .menu-block-1 li.active').append(o);\n  o.docNav = new DocNav(o, i);\n});\n"]}