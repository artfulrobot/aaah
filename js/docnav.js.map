{"version":3,"sources":["docnav.js"],"names":["DocNav","outputElement","inputElements","disableWaypoints","headings","find","last","l","length","baseLevel","parseInt","tagName","currentLevel","map","title","children","e","parent","currentParent","flatMap","i","eq","headingDepth","id","newChild","push","text","selected","thisDocNav","docnavVue","Vue","el","data","theMap","docNav","template","li","docnavWaypoint","Waypoint","element","offset","handler","selectItem","prototype","splice","ptr","component","props","methods","focus","preventDefault","addClass","scrollIntoView","window","setTimeout","removeClass","getClasses","c","depth","jQuery","o","wrap","append"],"mappings":"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","file":"docnav.js","sourcesContent":["function DocNav(outputElement, inputElements) {\n  this.disableWaypoints = true;\n  this.outputElement = outputElement;\n  this.inputElements = inputElements;\n  this.headings = this.inputElements.find('h1, h2, h3, h4, h5, h6');\n  var last = 0;\n  var l = this.headings.length;\n  var baseLevel = parseInt(this.headings[0].tagName[1]);\n  var currentLevel = 0;\n  var map = { title: 'No title', children: [], e:null, parent:null };\n  var currentParent = map;\n  var flatMap = {};\n  for (var i=0; i<l; i++) {\n    var e = this.headings.eq(i);\n    var headingDepth = e[0].tagName[1] - baseLevel;\n    if (!e[0].id) {\n      e[0].id = 'docnav' + i;\n    }\n\n    // Find the appropriate parent for this new thing, store it in currentParent.\n    if (headingDepth > currentLevel) {\n      // Deal with skipped headers, h2...h4\n      while (headingDepth > currentLevel) {\n        // Add empty child.\n        var newChild = { title: 'No title', children: [], e:null, parent:currentParent };\n        currentParent.children.push(newChild);\n        currentLevel++;\n        currentParent = newChild;\n      }\n    }\n    else if (headingDepth < currentLevel) {\n      while (headingDepth < currentLevel && currentLevel>0) {\n        // This is an ancestor.\n        currentParent = currentParent.parent;\n        currentLevel--;\n      }\n    }\n\n    // Got current Parent, create the element now and set that as the currentParent.\n    var newChild = { title: e.text(), children: [], e:e, parent: currentParent };\n    //console.log(e[0].tagName, \"currentParent: \", currentParent);\n    currentParent.children.push(newChild);\n    currentLevel++;\n    currentParent = newChild;\n    flatMap[e[0].id] = newChild;\n  }\n  this.map = map;\n  //console.log(\"map \", map, \"output ele\", this.outputElement);\n  // Create Vue app.\n  this.selected = [map.children[0]];\n  var thisDocNav = this;\n  var docnavVue = new Vue({\n    el: this.outputElement[0],\n    data: {theMap: map, selected : this.selected, docNav: thisDocNav },\n    template: `<docnav\n      :doc-nav=\"docNav\"\n      :item=\"theMap\"\n      :selected=\"selected\"\n      depth=\"0\" />`,\n  });\n\n  for (var i=0; i<l; i++) {\n    var e = this.headings.eq(i);\n    var li = flatMap[e[0].id];\n    // Set up a waypoint for this element.\n    (function(li){\n      li.e.docnavWaypoint = new Waypoint({\n        element: li.e[0],\n        offset: 'bottom-in-view',\n        handler: function() {\n          if (!thisDocNav.disableWaypoints) {\n            // console.log(\"handler firing \", li.title, thisDocNav.disableWaypoints);\n            // Find corresponding Vue element and trigger it's clicked method?\n            thisDocNav.selectItem(li);\n          }\n        }\n      });\n    })(li);\n  }\n\n  this.disableWaypoints = false;\n}\nDocNav.prototype.selectItem = function(li) {\n  this.selected.splice(0, this.selected.length, li);\n  //console.log(\"NEW SELECTION1:\", this.selected.map(x => { return x.title; }));\n  var ptr = li.parent;\n  while (ptr.parent) {\n    this.selected.push(ptr);\n    ptr = ptr.parent;\n  }\n};\n\nVue.component('docnav', {\n  props: ['item', 'depth', 'selected', 'docNav'],\n  template: `<ul :class=\"\\'depth-\\' + depth\">\n    <li v-for=\"li in item.children\"\n      :class=\"getClasses(li)\"\n      >\n      <a v-if=\"li.e\" href @click=\"focus(li, $event)\" >{{li.title}}</a>\n      <docnav\n        :selected=\"selected\"\n        :item=\"li\"\n        :doc-nav=\"docNav\"\n        :depth=\"parseInt(depth) + 1\"\n        v-if=\"li.children.length>0\"\n        />\n    </li></ul>`,\n  methods: {\n    focus: function(li, e) {\n      // console.log(\"focus\", li, e);\n      if (e) e.preventDefault();\n      this.docNav.disableWaypoints = true;\n      li.e.addClass('attention')[0].scrollIntoView();\n      this.docNav.selectItem(li);\n      window.setTimeout(function() { li.e.removeClass('attention');}, 1000);\n      var docNav = this.docNav;\n      window.setTimeout(function() { docNav.disableWaypoints = false; }, 300);\n    },\n    getClasses: function(li) {\n      //console.log(\"getClasses selected:\", this.selected, \" this li: \", li);\n      var c = {\n        selected: (li.e == this.selected[0].e)\n      };\n      c['depth-' + this.depth] = true;\n      var l = this.selected.length;\n      for (var i=1; i<l; i++) {\n        if (this.selected[i].e == li.e) {\n          c['selected-route'] = true;\n        }\n      }\n      if (li.e === null) {\n        // Inaccessible empty layers show as open.\n        c['selected-route'] = true;\n      }\n      return c;\n    }\n  }\n});\n\njQuery(function(){\n  // Sort out the wrapper stuff.\n  var i = jQuery('.field-name-body .field-item');\n  var o = jQuery('<div/>');\n  i = i.wrap('<div class=\"docnav__content\"/>').parent();\n  i.wrap('<div class=\"docnav-wrapper\"></div>').parent().append(jQuery('<div class=\"docnav__nav\"/>').append(o));\n  o.docNav = new DocNav(o, i);\n});\n"]}