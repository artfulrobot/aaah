{"version":3,"sources":["docnav.js"],"names":["DocNav","outputElement","inputElements","headings","find","last","l","length","baseLevel","parseInt","tagName","currentLevel","map","currentParent","stack","flatMap","i","e","eq","headingDepth","id","newChild","title","children","push","pop","text","console","log","Vue","el","data","theMap","selected","template","methods","setSelected","obj","component","props","focus","li","preventDefault","addClass","scrollIntoView","$emit","bubbleclick","getClasses","c","depth","jQuery","o","wrap","parent","append","docNav"],"mappings":"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","file":"docnav.js","sourcesContent":["function DocNav(outputElement, inputElements) {\n  this.outputElement = outputElement;\n  this.inputElements = inputElements;\n  this.headings = this.inputElements.find('h1, h2, h3, h4, h5, h6');\n  var last = 0;\n  var l = this.headings.length;\n  var baseLevel = parseInt(this.headings[0].tagName[1]);\n  var currentLevel = 0;\n  var map = [];\n  var currentParent = map;\n  var stack = [];\n  var flatMap = [];\n  for (var i=0; i<l; i++) {\n    var e = this.headings.eq(i);\n    var headingDepth = e[0].tagName[1] - baseLevel;\n    if (!e[0].id) {\n      e[0].id = 'docnav' + i;\n    }\n\n    // Find the appropriate parent for this new thing, store it in currentParent.\n    if (headingDepth > currentLevel) {\n      // Deal with skipped headers, h2...h4\n      while (headingDepth > currentLevel) {\n        // Add empty child.\n        var newChild = { title: 'No title', children: [], e:null };\n        currentParent.push(newChild);\n        currentLevel++;\n        stack.push(currentParent);\n        currentParent = newChild.children;\n      }\n    }\n    else if (headingDepth < currentLevel) {\n      while (headingDepth < currentLevel && currentLevel>0) {\n        // This is an ancestor.\n        currentParent = stack.pop();\n        currentLevel--;\n      }\n    }\n\n    // Got current Parent, create the element now and set that as the currentParent.\n    var newChild = { title: e.text(), children: [], e:e };\n    currentParent.push(newChild);\n    // Save the current parent as we'll need to go back to it.\n    stack.push(currentParent);\n    currentLevel++;\n    currentParent = newChild.children;\n    flatMap[e[0].id] = newChild;\n  }\n  this.map = map;\n  console.log(\"map \", map, \"output ele\", this.outputElement);\n  // Create Vue app.\n  new Vue({\n    el: this.outputElement[0],\n    data: {theMap: map, flatMap: flatMap, selected : [map[0]]},\n    template: '<docnav v-bind:items=\"theMap\" :flatMap=\"flatMap\" :selected=\"selected\" v-on:itemclicked=\"setSelected\" depth=\"0\" />',\n    methods: {\n      setSelected: function(obj) {\n        console.log(\"setSelected\", obj);\n        this.selected = obj;\n      }\n    }\n  });\n}\n\nVue.component('docnav', {\n  props: ['items', 'depth', 'selected'],\n  template: `<ul :class=\"\\'depth-\\' + depth\">\n    <li v-for=\"li in items\" :selected=\"selected\" :class=\"getClasses(li)\">\n      <a v-if=\"li.e\" href @click=\"focus(li, $event)\" >{{li.title}}</a>\n      <docnav\n        :selected=\"selected\"\n        v-bind:items=\"li.children\" v-bind:depth=\"parseInt(depth) + 1\"\n        v-on:itemclicked=\"bubbleclick(li, $event)\"\n        v-if=\"li.children.length>0\" />\n    </li></ul>`,\n  methods: {\n    focus: function(li, e) {\n      console.log(\"focus\", li, e);\n      if (e) e.preventDefault();\n      li.e.addClass('attention')[0].scrollIntoView();\n      this.$emit('itemclicked', [li]);\n    },\n    bubbleclick: function(li, obj) {\n      console.log(\"bubbleclick \", obj, li);\n      obj.push(li);\n      this.$emit('itemclicked', obj);\n    },\n    getClasses: function(li) {\n      var c = {\n        selected: (li.e == this.selected[0].e)\n      };\n      c['depth-' + this.depth] = true;\n      var l = this.selected.length;\n      for (var i=1; i<l; i++) {\n        if (this.selected[i].e == li.e) {\n          c['selected-route'] = true;\n        }\n      }\n      if (li.e === null) {\n        // Inaccessible empty layers show as open.\n        c['selected-route'] = true;\n      }\n      return c;\n    }\n  }\n});\n\njQuery(function(){\n  // Sort out the wrapper stuff.\n  var i = jQuery('.field-name-body .field-item');\n  var o = jQuery('<div/>');\n  i = i.wrap('<div class=\"docnav__content\"/>').parent();\n  console.log(\"i now \", i);\n  i.wrap('<div class=\"docnav-wrapper\"></div>').parent().append(jQuery('<div class=\"docnav__nav\"/>').append(o));\n  o.docNav = new DocNav(o, i);\n});\n"]}